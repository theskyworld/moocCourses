### 项目分析

![image-20230826080141526](C:\Users\ycx\AppData\Roaming\Typora\typora-user-images\image-20230826080141526.png)

### 业务闭环

问卷创建者 → 新建问卷 → 编辑问卷 → 发布问卷 → 问卷H5页面
   👆                                           ⬇
分析结果   👈  后台统计并分析页面  👈 用户填写页面并提交

### 项目组件分析

![image-20230826080407619](C:\Users\ycx\AppData\Roaming\Typora\typora-user-images\image-20230826080407619.png)

### 项目页面

![image-20230828141801145](C:\Users\ycx\AppData\Roaming\Typora\typora-user-images\image-20230828141801145.png)

路由设计

- 首页 `'/'`
- 登录页 `'/login'`
- 注册页 `'/register'`
- 问卷管理
  - 我的问卷 `'/manage/list'`
  - 星标问卷 `'/manage/star'`
  - 回收站 `'/manage/trash'`
- 问卷详情
  - 编辑问卷 `/question/edit/:id`
  - 问卷统计 `/question/stat/:id`
- 404

### API 设计

设计时对应的前端需求

- 跟用户相关
  - 注册
  - 登录
  - 获取用户信息
- 跟问卷相关
  - 创建问卷
  - 获取单个问卷
  - 更新问卷
  - 删除问卷
  - 查询问卷列表
  - 复制问卷

#### 用户功能

##### 获取用户信息

`errno`为错误编号，其值为错误编码库中定义的值

- method `get`
- path `/api/user/info`
- response `{ errno: 0, data: {...} }` 或 `{ errno: 10001, msg: 'xxx' }`

##### 注册

- method `post`
- path `/api/user/register`
- request body `{ username, password, nickname }`
- response `{ errno: 0 }`

##### 登录

- method `post`
- path `/api/user/login`
- request body `{ username, password }`
- response `{ errno: 0, data: { token } }` —— **JWT** 使用 token

#### 问卷功能

##### 创建问卷

- method `post`
- path `/api/question`
- request body - 无 （点击一个按钮即可创建，title 自动生成）
- response `{ errno: 0, data: { id } }`

##### 获取单个问卷

- method `get`
- path `/api/question/:id`
- response `{ errno: 0, data: { id, title ... } }`

##### 获取问卷列表

- method `get`
- path `/api/question-list`
- response: `{ errno: 0, data: { list: [ ... ], total } }`

##### 更新问卷信息

- method `patch`
- path `/api/question/:id`
- request body `{ title, isStar ... }` （之前忘记了，现补上）
- response: `{ errno: 0 }`

PS：删除是`假删除`，实际是更新 `isDeleted` 属性

##### 批量彻底删除问卷

- method `delete`
- path `/api/question`
- request body `{ ids: [ ... ] }`
- response: `{ errno: 0 }`

##### 复制问卷

- method `post`
- path `/api/question/duplicate/:id`
- response: `{ errno: 0, data: { id } }`

#### 小结

- 使用 Restful API
- 用户验证使用 JWT （后面再讲）
- 统一返回格式 `{ errno, data, msg }`

### 不同组件之间解耦的实现

- 搜索框与列表展示组件之间的解耦：搜索框的搜索结果不时来源于列表展示组件之中已有数据的过滤结果，而是通过输入搜索关键字之后，将关键字信息添加到url中，到后端请求到对应的搜索结果数据。当需要url中相关的数据时，可通过`useSearchParams`函数进行获取
- 分页与列表展示组件之间的解耦：类似于搜索框，将当前页数信息添加到url中，向后端请求到对应页的数据
- 同时星标问卷和回收站组件与列表组件之间的解耦也与上面类似，将`isStar`和`isDeleted`的信息传递给后端，进行数据的请求
